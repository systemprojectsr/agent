<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∞—É—Ç—Å–æ—Ä—Å–∏–Ω–≥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.success {
            background: #28a745;
        }
        button.danger {
            background: #dc3545;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .response {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∞—É—Ç—Å–æ—Ä—Å–∏–Ω–≥–∞</h1>
    
    <div class="container">
        <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <div class="grid">
            <div>
                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="clientEmail" placeholder="client@example.com">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="clientPassword" placeholder="password123">
                </div>
                <div class="form-group">
                    <label>–ò–º—è:</label>
                    <input type="text" id="clientName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                </div>
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="text" id="clientPhone" placeholder="+7 (999) 123-45-67">
                </div>
                <button onclick="registerClient()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç</button>
            </div>
            
            <div>
                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–∏</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="companyEmail" placeholder="company@example.com">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="companyPassword" placeholder="password123">
                </div>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                    <input type="text" id="companyName" placeholder="–û–û–û –°–µ—Ä–≤–∏—Å">
                </div>
                <div class="form-group">
                    <label>–§–ò–û –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è:</label>
                    <input type="text" id="companyRepName" placeholder="–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤">
                </div>
                <button onclick="registerCompany()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∫–æ–º–ø–∞–Ω–∏—è</button>
            </div>
        </div>
        
        <div class="form-group">
            <h3>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
            <label>Email:</label>
            <input type="email" id="loginEmail" placeholder="email@example.com">
            <label>–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="loginPassword" placeholder="password">
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <button onclick="logout()" class="danger">–í—ã–π—Ç–∏</button>
        </div>
        
        <div class="response" id="authResponse">–û—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
    </div>

    <div class="container">
        <h2>üè∑Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —É—Å–ª—É–≥</h2>
        <div class="grid">
            <div>
                <h3>–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
                <button onclick="getAllCards()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏</button>
            </div>
            
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É (–∫–æ–º–ø–∞–Ω–∏—è)</h3>
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="cardTitle" placeholder="–£–±–æ—Ä–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="cardDescription" placeholder="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–±–æ—Ä–∫–∞..."></textarea>
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                <input type="text" id="cardCategory" placeholder="–ö–ª–∏–Ω–∏–Ω–≥">
                <label>–õ–æ–∫–∞—Ü–∏—è:</label>
                <input type="text" id="cardLocation" placeholder="–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω">
                <label>–¶–µ–Ω–∞:</label>
                <input type="number" id="cardPrice" placeholder="2000">
                <button onclick="createCard()">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
            </div>
        </div>
        
        <div class="response" id="cardsResponse">–û—Ç–≤–µ—Ç—ã –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
    </div>

    <div class="container">
        <h2>üí∞ –ë–∞–ª–∞–Ω—Å –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
        <div class="grid">
            <div>
                <h3>–ë–∞–ª–∞–Ω—Å</h3>
                <button onclick="getBalance()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                <br>
                <label>–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                <input type="number" id="depositAmount" placeholder="1000">
                <button onclick="depositBalance()" class="success">–ü–æ–ø–æ–ª–Ω–∏—Ç—å (–∫–ª–∏–µ–Ω—Ç)</button>
            </div>
            
            <div>
                <h3>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                <button onclick="getTransactions()">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</button>
            </div>
        </div>
        
        <div class="response" id="balanceResponse">–û—Ç–≤–µ—Ç—ã –ø–æ –±–∞–ª–∞–Ω—Å—É –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
    </div>

    <div class="container">
        <h2>üìã –ó–∞–∫–∞–∑—ã</h2>
        <div class="grid">
            <div>
                <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (–∫–ª–∏–µ–Ω—Ç)</h3>
                <label>ID –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                <input type="number" id="orderCompanyId" placeholder="1">
                <label>ID –∫–∞—Ä—Ç–æ—á–∫–∏:</label>
                <input type="number" id="orderCardId" placeholder="1">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="orderDescription" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è..."></textarea>
                <button onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
            
            <div>
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h3>
                <label>ID –∑–∞–∫–∞–∑–∞:</label>
                <input type="number" id="managementOrderId" placeholder="1">
                <button onclick="payOrder()" class="success">–û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button onclick="startOrder()">–ù–∞—á–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
                <button onclick="finishOrder()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button onclick="cancelOrder()" class="danger">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
        </div>
        
        <button onclick="getOrders()">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
        
        <div class="response" id="ordersResponse">–û—Ç–≤–µ—Ç—ã –ø–æ –∑–∞–∫–∞–∑–∞–º –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
    </div>

    <script>
        const API_URL = 'https://auth.tomsk-center.ru';
        let authToken = localStorage.getItem('authToken');

        function updateTokenDisplay() {
            const display = document.getElementById('authResponse');
            if (authToken) {
                display.innerHTML = `‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –¢–æ–∫–µ–Ω: ${authToken.substring(0, 20)}...`;
            } else {
                display.innerHTML = '‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
            }
        }

        function displayResponse(elementId, response, isError = false) {
            const element = document.getElementById(elementId);
            element.className = isError ? 'response error' : 'response';
            element.innerHTML = JSON.stringify(response, null, 2);
        }

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                const data = await response.json();
                return { data, status: response.status, ok: response.ok };
            } catch (error) {
                return { error: error.message, status: 0, ok: false };
            }
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function registerClient() {
            const data = {
                user: {
                    register: {
                        full_name: document.getElementById('clientName').value,
                        email: document.getElementById('clientEmail').value,
                        phone: document.getElementById('clientPhone').value,
                        password: document.getElementById('clientPassword').value,
                        photo: '',
                        type: 'client'
                    }
                }
            };

            const result = await makeRequest(`${API_URL}/v1/register/client`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result.ok && result.data.user?.token) {
                authToken = result.data.user.token;
                localStorage.setItem('authToken', authToken);
                updateTokenDisplay();
            }

            displayResponse('authResponse', result.data || result.error, !result.ok);
        }

        async function registerCompany() {
            const data = {
                user: {
                    register: {
                        company_name: document.getElementById('companyName').value,
                        full_name: document.getElementById('companyRepName').value,
                        email: document.getElementById('companyEmail').value,
                        phone: '+7 (999) 888-77-66',
                        password_hash: document.getElementById('companyPassword').value,
                        position_agent: '–î–∏—Ä–µ–∫—Ç–æ—Ä',
                        id_company: '–û–û–û12345',
                        address: '–≥. –¢–æ–º—Å–∫',
                        type_service: '–†–∞–∑–ª–∏—á–Ω—ã–µ —É—Å–ª—É–≥–∏',
                        photo: '',
                        documents: [],
                        type: 'company'
                    }
                }
            };

            const result = await makeRequest(`${API_URL}/v1/register/company`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result.ok && result.data.user?.token) {
                authToken = result.data.user.token;
                localStorage.setItem('authToken', authToken);
                updateTokenDisplay();
            }

            displayResponse('authResponse', result.data || result.error, !result.ok);
        }

        async function login() {
            const data = {
                user: {
                    login: {
                        email: document.getElementById('loginEmail').value,
                        password_hash: document.getElementById('loginPassword').value
                    }
                }
            };

            const result = await makeRequest(`${API_URL}/v1/login`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result.ok && result.data.user?.token) {
                authToken = result.data.user.token;
                localStorage.setItem('authToken', authToken);
                updateTokenDisplay();
            }

            displayResponse('authResponse', result.data || result.error, !result.ok);
        }

        function logout() {
            authToken = null;
            localStorage.removeItem('authToken');
            updateTokenDisplay();
        }

        // –ö–∞—Ä—Ç–æ—á–∫–∏
        async function getAllCards() {
            const result = await makeRequest(`${API_URL}/cards?page=1&limit=10`);
            displayResponse('cardsResponse', result.data || result.error, !result.ok);
        }

        async function createCard() {
            if (!authToken) {
                displayResponse('cardsResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                card: {
                    title: document.getElementById('cardTitle').value,
                    description: document.getElementById('cardDescription').value,
                    category: document.getElementById('cardCategory').value,
                    location: document.getElementById('cardLocation').value,
                    price: parseFloat(document.getElementById('cardPrice').value)
                }
            };

            const result = await makeRequest(`${API_URL}/v1/account/card/create`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('cardsResponse', result.data || result.error, !result.ok);
        }

        // –ë–∞–ª–∞–Ω—Å
        async function getBalance() {
            if (!authToken) {
                displayResponse('balanceResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = { user: { login: { token: authToken } } };
            const result = await makeRequest(`${API_URL}/v1/account/balance`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('balanceResponse', result.data || result.error, !result.ok);
        }

        async function depositBalance() {
            if (!authToken) {
                displayResponse('balanceResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                amount: parseFloat(document.getElementById('depositAmount').value)
            };

            const result = await makeRequest(`${API_URL}/v1/account/balance/deposit`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('balanceResponse', result.data || result.error, !result.ok);
        }

        async function getTransactions() {
            if (!authToken) {
                displayResponse('balanceResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = { user: { login: { token: authToken } } };
            const result = await makeRequest(`${API_URL}/v1/account/balance/transactions?page=1&limit=10`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('balanceResponse', result.data || result.error, !result.ok);
        }

        // –ó–∞–∫–∞–∑—ã
        async function createOrder() {
            if (!authToken) {
                displayResponse('ordersResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                order: {
                    company_id: parseInt(document.getElementById('orderCompanyId').value),
                    card_id: parseInt(document.getElementById('orderCardId').value),
                    description: document.getElementById('orderDescription').value
                }
            };

            const result = await makeRequest(`${API_URL}/v1/account/order/create`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('ordersResponse', result.data || result.error, !result.ok);
        }

        async function getOrders() {
            if (!authToken) {
                displayResponse('ordersResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = { user: { login: { token: authToken } } };
            const result = await makeRequest(`${API_URL}/v1/account/order/list?page=1&limit=10`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('ordersResponse', result.data || result.error, !result.ok);
        }

        async function payOrder() {
            if (!authToken) {
                displayResponse('ordersResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                order_id: parseInt(document.getElementById('managementOrderId').value)
            };

            const result = await makeRequest(`${API_URL}/v1/account/order/pay`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('ordersResponse', result.data || result.error, !result.ok);
        }

        async function startOrder() {
            if (!authToken) {
                displayResponse('ordersResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                order_id: parseInt(document.getElementById('managementOrderId').value)
            };

            const result = await makeRequest(`${API_URL}/v1/account/order/start`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('ordersResponse', result.data || result.error, !result.ok);
        }

        async function finishOrder() {
            if (!authToken) {
                displayResponse('ordersResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                order_id: parseInt(document.getElementById('managementOrderId').value)
            };

            const result = await makeRequest(`${API_URL}/v1/account/order/finish`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('ordersResponse', result.data || result.error, !result.ok);
        }

        async function cancelOrder() {
            if (!authToken) {
                displayResponse('ordersResponse', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', true);
                return;
            }

            const data = {
                user: { login: { token: authToken } },
                order_id: parseInt(document.getElementById('managementOrderId').value)
            };

            const result = await makeRequest(`${API_URL}/v1/account/order/cancel`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            displayResponse('ordersResponse', result.data || result.error, !result.ok);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateTokenDisplay();
    </script>
</body>
</html>
