<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        .endpoint { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —É—Å–ª—É–≥</h1>
        
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å API –∏ CORS.</p>
        
        <button onclick="testAllEndpoints()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ API</button>
        <button onclick="testSearchOnly()">–¢–æ–ª—å–∫–æ –ø–æ–∏—Å–∫ —É—Å–ª—É–≥</button>
        <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        
        <div id="results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            resultsDiv.appendChild(div);
            console.log(message);
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        async function testEndpoint(name, url, method = 'GET') {
            const endpointDiv = document.createElement('div');
            endpointDiv.className = 'endpoint';
            endpointDiv.innerHTML = `<h3>–¢–µ—Å—Ç–∏—Ä—É–µ–º: ${name}</h3><p>URL: ${url}</p>`;
            resultsDiv.appendChild(endpointDiv);
            
            try {
                log(`üîÑ –ó–∞–ø—Ä–æ—Å –∫ ${name}...`);
                
                const response = await fetch(url, {
                    method: method,
                    mode: 'cors'
                });
                
                log(`‚úÖ ${name}: ${response.status} ${response.statusText}`, 'success');
                
                if (response.ok) {
                    try {
                        const data = await response.json();
                        
                        if (url.includes('search')) {
                            log(`üìä –ü–æ–ª—É—á–µ–Ω–æ —É—Å–ª—É–≥: ${Array.isArray(data) ? data.length : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`, 'success');
                            if (Array.isArray(data) && data.length > 0) {
                                log(`üìã –ü–µ—Ä–≤–∞—è —É—Å–ª—É–≥–∞: ${data[0].name} - ${data[0].price}‚ÇΩ`, 'success');
                                log(`üìã –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö: <pre>${JSON.stringify(data.slice(0, 2), null, 2)}</pre>`, 'success');
                            }
                        } else {
                            log(`üìã –û—Ç–≤–µ—Ç: <pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`, 'success');
                        }
                    } catch (jsonError) {
                        log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å JSON: ${jsonError.message}`, 'warning');
                    }
                } else {
                    log(`‚ùå ${name}: HTTP ${response.status}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå ${name}: ${error.message}`, 'error');
                
                if (error.message.includes('CORS')) {
                    log(`üö´ CORS –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è ${name} - —ç—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ`, 'warning');
                } else if (error.message.includes('Failed to fetch')) {
                    log(`üåê –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è ${name} - –≤–æ–∑–º–æ–∂–Ω–æ CORS –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞`, 'warning');
                }
            }
        }
        
        async function testSearchOnly() {
            clearResults();
            log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ API –ø–æ–∏—Å–∫–∞ —É—Å–ª—É–≥');
            await testEndpoint('–ü–æ–∏—Å–∫ —É—Å–ª—É–≥', 'https://search.tomsk-center.ru/search');
        }
        
        async function testAllEndpoints() {
            clearResults();
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É API');
            
            const endpoints = [
                ['–ü–æ–∏—Å–∫ —É—Å–ª—É–≥', 'https://search.tomsk-center.ru/search'],
                ['–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'https://auth.tomsk-center.ru/v1/login'],
                ['–§–æ—Ç–æ—Å–µ—Ä–≤–∏—Å', 'https://dsam.tomsk-center.ru/photos'],
                ['–ß–∞—Ç', 'https://chat.tomsk-center.ru/']
            ];
            
            for (const [name, url] of endpoints) {
                await testEndpoint(name, url);
                await new Promise(resolve => setTimeout(resolve, 1000)); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            }
            
            log('üèÅ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            log('üì± –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ API –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('üîß –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API');
        });
    </script>
</body>
</html>
