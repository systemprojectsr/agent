#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∞—É—Ç—Å–æ—Ä—Å–∏–Ω–≥–∞ —Å —ç—Å–∫—Ä–æ—É-–ø–ª–∞—Ç–µ–∂–∞–º–∏"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Go
if ! command -v go &> /dev/null; then
    echo "‚ùå Go –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Go..."
    
    # –î–ª—è Ubuntu/Debian
    if command -v apt &> /dev/null; then
        sudo apt update
        sudo apt install -y golang-go
    # –î–ª—è CentOS/RHEL
    elif command -v yum &> /dev/null; then
        sudo yum install -y golang
    else
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
        echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Go –≤—Ä—É—á–Ω—É—é: https://golang.org/doc/install"
        exit 1
    fi
fi

echo "‚úÖ Go —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $(go version)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ ! -f ".env" ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω. –ö–æ–ø–∏—Ä—É–µ–º .env.example..."
    cp .env.example .env
    echo "üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ PostgreSQL"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
go mod tidy

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–ø–∏–ª—è—Ü–∏—é
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏..."
if go build cmd/api/main.go; then
    echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ"
    rm -f main
else
    echo "‚ùå –û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
echo "üåê –ó–∞–ø—É—Å–∫ Go —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8080..."
echo "üìã API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:8080"
echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ—Ç–∫—Ä–æ–π—Ç–µ templates/api_test.html –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
echo "üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: README.md"
echo ""
echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"

go run cmd/api/main.go
