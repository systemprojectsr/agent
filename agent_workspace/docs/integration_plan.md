# План интеграции Backend и Frontend

## Выявленные проблемы

### 1. Критические проблемы с API интеграцией

#### Проблема A: Неправильная конфигурация URL
- **Frontend**: В `/public/api_client.js` используются внешние URL (`tomsk-center.ru`)
- **Backend**: Работает локально на порту 8080
- **Решение**: Обновить API клиент для использования правильных URL

#### Проблема B: Несоответствие API структур данных
- **Frontend**: В `ProfilePage.tsx` отправляет данные в старом формате через `/public/api_client.js`
- **Backend**: Ожидает новые структуры данных `ClientProfileInfo` и `TokenUpdateClientProfile`
- **Решение**: Привести форматы данных в соответствие

#### Проблема C: Дублирование API клиентов
- Есть два API клиента: `/public/api_client.js` и `/src/config/api.ts`
- Они работают с разными URL и форматами данных
- **Решение**: Унифицировать API клиенты

### 2. Проблемы с профилем пользователя

#### Проблема D: Неправильная структура запроса обновления профиля
**Frontend отправляет:**
```json
{
  "token_access": {
    "user": {
      "login": {
        "token": "..."
      }
    }
  },
  "profile": {
    "full_name": "...",
    "email": "...",
    "phone": "...",
    "photo": "..."
  }
}
```

**Backend ожидает структуру** `TokenUpdateClientProfile`:
```go
type TokenUpdateClientProfile struct {
    TokenAccess TokenAccess       `json:"token_access"`
    Profile     ClientProfileInfo `json:"profile"`
}

type ClientProfileInfo struct {
    FullName string `json:"full_name"`
    Email    string `json:"email"`
    Phone    string `json:"phone"`
    Photo    string `json:"photo"`
}
```

#### Проблема E: Неправильный endpoint для получения профиля
- **Frontend**: Использует `/v1/account/` с POST запросом
- **Backend**: Требует правильной обработки в main.go

## План исправления

### Этап 1: Исправление API конфигурации (Критично)
1. ✅ **Обновить API URL** в frontend для работы с локальным backend
2. ✅ **Унифицировать API клиенты** - удалить старый, использовать только новый
3. ✅ **Проверить все endpoints** в backend

### Этап 2: Исправление профиля пользователя (Критично)
1. ✅ **Исправить структуры данных** в ProfilePage.tsx
2. ✅ **Обновить API запросы** для соответствия backend структурам
3. ✅ **Добавить недостающие endpoints** в backend если нужно

### Этап 3: Тестирование и проверка (Критично)
1. ✅ **Протестировать авторизацию**
2. ✅ **Протестировать получение профиля**
3. ✅ **Протестировать обновление профиля**
4. ✅ **Протестировать работу с балансом**

### Этап 4: Дополнительные улучшения
1. ✅ **Улучшить обработку ошибок**
2. ✅ **Добавить типизацию** TypeScript
3. ✅ **Оптимизировать структуру API**

## Детальный план действий

### 1. Исправление API клиента (Первоочередная задача)

**Проблема:** Frontend использует неправильные URL и старые структуры данных.

**Действия:**
- Удалить `/public/api_client.js` (устаревший)
- Обновить `/src/config/api.ts` для правильной работы с backend
- Обновить все компоненты для использования нового API клиента

### 2. Исправление ProfilePage.tsx

**Проблема:** Неправильные структуры запросов и ответов.

**Действия:**
- Обновить интерфейсы TypeScript
- Исправить структуры API запросов
- Добавить правильную обработку ответов

### 3. Проверка Backend endpoints

**Проблема:** Не все endpoints правильно настроены в main.go.

**Действия:**
- Проверить маршруты для аккаунта
- Убедиться в правильной работе авторизации
- Добавить недостающие endpoints

## Ожидаемый результат

После исправления:
1. ✅ **Профиль будет корректно загружаться** с backend
2. ✅ **Обновление профиля будет работать** без ошибок
3. ✅ **Все API запросы будут отправляться** на правильные endpoints
4. ✅ **Данные будут передаваться** в правильном формате
5. ✅ **Авторизация будет работать** корректно

## Файлы для изменения

### Frontend:
- ❌ `/public/api_client.js` - удалить
- ✅ `/src/config/api.ts` - обновить
- ✅ `/src/pages/ProfilePage.tsx` - исправить
- ✅ `/src/contexts/AuthContext.tsx` - проверить и обновить

### Backend:
- ✅ `/cmd/api/main.go` - проверить routes
- ✅ `/internal/controller/client_controller.go` - проверить методы
- ✅ `/internal/api/auth.go` - проверить структуры

## Следующие шаги

1. **Немедленно**: Исправить API URL и структуры данных
2. **В течение сессии**: Протестировать все исправления
3. **Проверить**: Корректность работы авторизации и профиля
